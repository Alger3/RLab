---
title: "Assignment5"
author: "Jack"
date: "2024-10-16"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(Stat2Data)
data("Hawks")
```

# 1. Exploratory data analysis
```{r}
head(Hawks)
```

## 1.1 Q1
```{r}
HawksTail <- Hawks[["Tail"]]
HawksTailMean <- HawksTail %>% mean(na.rm=TRUE)
HawksTailMedian <- HawksTail %>% median(na.rm=TRUE)
# Mean
HawksTailMean
# Median
HawksTailMedian
```

## 1.2 Q1
```{r}
s <- Hawks %>% summarise(across(c("Wing","Weight"),list(mean=~mean(.,na.rm=TRUE),t_mean=~ quantile(.,probs=0.5,na.rm=TRUE),median=~median(.,na.rm=TRUE)),.names="{.col}_{.fn}"))
s
```

## 1.2 Q2
```{r}
s_group <- Hawks %>% group_by(Species) %>% summarise(across(c("Wing","Weight"),list(mean=~mean(.,na.rm=TRUE),t_mean=~ quantile(.,probs=0.5,na.rm=TRUE),median=~median(.,na.rm=TRUE)),.names="{.col}_{.fn}"))
s_group
```

## 1.3 Q1
$Mean=b+aA$

```{r}
# verify
HawksTailMean
mean(HawksTail*2+3)
```

## 1.3 Q2
$sample \quad variance = a^2 \times p$
```{r}
# HawksTail sample variance
var(HawksTail,na.rm=TRUE)
var(HawksTail*2+3,na.rm=TRUE)
4*var(HawksTail,na.rm=TRUE)
```

$sample \quad deviation=a \sqrt{p}=a \times q$
```{r}
# HawksTail sample deviation
sd(HawksTail,na.rm=TRUE)
sd(HawksTail*2+3,na.rm=TRUE)
2*sd(HawksTail,na.rm=TRUE)
```

## 1.4
```{r}
hal <- Hawks[["Hallux"]] # Extract the vector of hallux lengths
hal <- hal[!is.na(hal)] # remove any nans

outlier_val <- 100
num_outliers <- 10
corrupted_hal <- c(hal,rep(outlier_val,times=num_outliers))

mean(hal)
mean(corrupted_hal)

num_outliers_vect <- seq(0,1000)
means_vect <- c()
for(num_outliers in num_outliers_vect){
  corrupted_hal <- c(hal,rep(outlier_val,times=num_outliers))
  means_vect <- c(means_vect,mean(corrupted_hal))
}
means_vect %>% head(5)
```

## 1.4 Q1 Sample median
```{r}
medians_vect <- c()
for(num_outliers in num_outliers_vect){
  corrupted_hal <- c(hal,rep(outlier_val,times=num_outliers))
  medians_vect <- c(medians_vect,median(corrupted_hal))
}
medians_vect %>% head(5)
```

## 1.4 Q2 Sample trimmed mean
```{r}
t_means_vect <- c()
for(num_outliers in num_outliers_vect){
  corrupted_hal <- c(hal,rep(outlier_val,times=num_outliers))
  t_means_vect <- c(t_means_vect,mean(corrupted_hal,trim=0.1))
}
t_means_vect %>% head(5)
```

## 1.4 Q3 Visualisation
```{r}
df_means_medians <- data.frame(num_outliers=num_outliers_vect,mean=means_vect,t_mean=t_means_vect,median=medians_vect)
df_means_medians %>% head(5)

df_means_medians %>% pivot_longer(!num_outliers,names_to="Estimator",values_to="Value") %>% ggplot(aes(x=num_outliers,color=Estimator,linetype=Estimator,y=Value))+geom_line()+xlab("Number of outliers")

# I think they are all stable when the number of outliers is small
```

## 1.5 Box plots and outliers

## 1.5 Q1
```{r}
ggplot(data=Hawks,aes(x=Species,y=Weight))+geom_boxplot()
```

## 1.5 Q2 quantile and boxplots
```{r}
quantiles <- Hawks %>% group_by(Species) %>% summarise(across("Weight",list(quantile025=~quantile(.,probs=0.25,na.rm=TRUE),quantile050=~ quantile(.,probs=0.5,na.rm=TRUE),quantile075=~quantile(.,probs=0.75,na.rm=TRUE))))
quantiles

# These numbers are correspond to the box (interquartile range)
```

## 1.5 Q3 Outliers
```{r}
num_outliers <- function(x){
  #remove any nans
  x <- x[!is.na(x)]
  # compute q25 and q75
  q25 <- quantile(x,0.25,na.rm=TRUE)
  q75 <- quantile(x,0.75,na.rm=TRUE)
  # create IQR
  IQR <- q75 - q25
  n <- 0
  for(num in x){
    if(num < q25-1.5*IQR | num > q75+1.5*IQR){
      n <- n + 1
    }
  }
  return (n)
}
num_outliers(c(0,40,60,185))
```

## 1.5 Q4 Outliers by group
```{r}
Hawks %>% group_by(Species) %>% summarise(across("Weight",list(num_outliers_weight=~num_outliers(.))))
```

## 1.6 Covariance and correlation under linear transformations

## 1.6 Q1 Compute the covariance and correlation
```{r}
cov(Hawks[["Weight"]],Hawks[["Wing"]],use="complete.obs")
cor(Hawks[["Weight"]],Hawks[["Wing"]],use="complete.obs")
```

## 1.6 Q2
$Cov(\tilde{X},\tilde{Y})=a \times c \times Cov(X,Y)=a \times c \times S$
```{r}
# Verify Cov
cov(Hawks[["Weight"]]*2.4+7.1,Hawks[["Wing"]]*(-1)+3,use="complete.obs")
cov(Hawks[["Weight"]],Hawks[["Wing"]],use="complete.obs")*2.4*(-1)
```


$Cor(\tilde{X},\tilde{Y})=R$
```{r}
# Verify Cor
cor(Hawks[["Weight"]]*2.4+7.1,Hawks[["Wing"]]*(-1)+3,use="complete.obs")
cor(Hawks[["Weight"]],Hawks[["Wing"]],use="complete.obs")
```


# 2. Random variables and discrete random variables

## 2.1 Q1 Expectation and variance
$E[(X-\overline{X})\cdot(Y-\overline{Y})]=E(XY)-E(X\overline{Y})-E(\overline{X}Y)+E(\overline{X}\overline{Y})=E(XY)-E(XY)-E(XY)+E(XY)=0$

## 2.2 Distribution

## 2.2 Q1

### 1. What is the probability mass function px for X?
$p_X(x)=P(X=x)=
\begin{cases}
\alpha,X=3 \\
\beta,X=10 \\
1-\alpha-\beta,X=0 \\
0, otherwise
\end{cases}
$

### 2. What is the expectation of ùëã?
$E(X)=\sum_{x} x \cdot p_X(x)=3 \cdot \alpha+10 \cdot \beta + 0 \times (1-\alpha-\beta)=3\alpha+10\beta$

### 3. What is the variance of X?
$Var(X)=E[(X-E(X))^2]=\sum_{x}(X-E(X))^2 \cdot p_X(x)=(3-3\alpha-10\beta)^2 \times \alpha + (10-3\alpha-10\beta)^2 \times \beta + (0-3\alpha-10\beta)^2 \times (1-\alpha-\beta) = 9\alpha+100\beta-9\alpha^2-100\beta^2-60\alpha\beta$

### 4. What is the standard deviation of X?
$\sigma{(X)}=\sqrt{Var(X)}=\sqrt{9\alpha+100\beta-9\alpha^2-100\beta^2-60\alpha\beta}$

## 2.2 Q2 Distribution and distribution function
### 1.
$P(S)=\alpha \times 1_{(3)}(x) + \beta \times 1_{(10)}(x) + (1-\alpha-\beta) \times \ 1_{(0)}(x)$

### 2. Write down the distribution function ùêπ of ùëã 
$F_X(x)=
\begin{cases}
0,& \quad if \quad x<0 \\
1-\alpha-\beta,& \quad if \quad 0\leq x < 3 \\
1-\beta,& \quad if \quad 3 \leq x <10 \\
1,& \quad if \quad x \geq 10
\end{cases}$

## 2.2 Q3 Variance and Covariance
$Var(Y)=n \cdot Var(X)=n \cdot (9\alpha+100\beta-9\alpha^2-60\alpha\beta-100\beta^2)$

## 2.2 Q4
```{r}
# create function to generate a sample then return a vector
Gen_X_numbers <- function(n){
  numbers <- c()
  nums <- sample(seq(0,1,by=0.01),n)
  for(num in nums){
    if(num < 0.5){
      numbers <- c(numbers,0)
    }else if(num < 0.7){
      numbers <- c(numbers,3)
    }else{
      numbers <- c(numbers,10)
    }
  }
  return (numbers)
}
Gen_X_numbers(4)

# create function to generate a sample of Y
Gen_Y_samples <- function(m,n){
  iters <- seq(1,m)
  Y <- map_dbl(iters,~sum(Gen_X_numbers(n)))
  result <- data.frame(index=iters,Y=Y)
  return (result)
}
Gen_Y_samples(5,2)

# let n=3, m=50000
Gen_Y_samples(50000,3) %>% ggplot(aes(x=Y)) + geom_bar() + ylab("count")

# increase the values of n to 20
Gen_Y_samples(50000,20) %>% ggplot(aes(x=Y)) + geom_bar() + ylab("count")

# increase n to 1000
# It is too large
#Gen_Y_samples(50000,1000) %>% ggplot(aes(x=Y)) + geom_bar() + ylab("count")
```

# 3. Continuous random variables and limit laws

## 3.1 Simulating data with the uniform distribution

## 3.1 Q1
$\mathbb{P}(U \in [a,b])=\int_a^b1dx=b-a$

## 3.1 Q2
```{r}
set.seed(0)
n <- 1000
sample_X <- data.frame(U=runif(n)) %>% mutate(X=case_when(
  (0<=U)&(U<0.25)~3,
  (0.25<=U)&(U<0.5)~10,
  (0.5<=U)&(U<=1)~0
)) %>% pull(X)

X3 <- 0
X10 <- 0
X0 <- 0
for(n in sample_X){
  if (n == 3){
    X3 <- X3+1
  }else if(n == 10){
    X10 <- X10+1
  }else{
    X0 <- X0+1
  }
}
X3/1000
X10/1000
X0/1000
```

## 3.1 Q3
```{r}
sample_X_0310 <- function(alpha,beta,n){
  probability <- c(alpha,beta,1-alpha-beta)
  return (sample(c(3,10,0),n,replace=TRUE,prob=probability))
}
sample_X_0310(0.25,0.25,10)
```

## 3.1 Q4
```{r}
X <- sample_X_0310(1/2,1/10,10000)
X_mean <- mean(X,na.rm=TRUE)
X_mean
X_E <- 3*(1/2) + 10*(1/10) + 0*(1-1/2-1/10)
X_E
# They are closed, if the sample is larger, then they will be closer
```

## 3.1 Q5
```{r}
X_Var <- var(X,na.rm=TRUE)
X_Var
3*3*(1/2) + 10*10*(1/10) + 0*0*(1-1/2-1/10) - (3*(1/2) + 10*(1/10) + 0*(1-1/2-1/10))^2
```

## 3.1 Q6
```{r}
# 1. "beta" column
beta <- seq(0,9/10,by=0.01)

# 2. "sample_X" column
# 3. "samplemean" column
sample_list <- list()
sample_mean <- c()
for(value in beta){
  sample_X <- sample_X_0310(1/10,value,100)
  sample_mean <- c(sample_mean,mean(sample_X,na.rm=TRUE))
  sample_list <- append(sample_list, list(paste(sample_X, collapse=", ")))
}
result <- data.frame(beta=beta, sample_X=unlist(sample_list), samplemean=sample_mean)

result <- result %>% mutate(Expectation=3*(1/10)+10*beta)
```

## 3.1 Q7
```{r}
result %>% ggplot(aes(x=beta)) + geom_point(aes(y=samplemean, color="samplemean")) + geom_point(aes(y=Expectation,color="Expectation")) + xlab("beta") + ylab("value")
```

















